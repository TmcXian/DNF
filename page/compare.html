<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="DNF 115版本套装对比工具 - 快速对比各套装属性、难度、适用场景">
    <meta name="keywords" content="DNF,115版本,套装对比,黄金乡,龙战八荒,群猎美学">
    <meta name="author" content="DNF工具站">
    <title>套装对比工具 - DNF 115版本工具</title>
    <!-- 样式文件加载优化：preload关键样式 -->
    <link rel="preload" href="../static/css/base.css" as="style">
    <link rel="preload" href="../static/css/page/compare.css" as="style">
    <!-- 基础样式 -->
    <link rel="stylesheet" href="../static/css/base.css">
    <!-- DNF专属样式（若存在） -->
    <link rel="stylesheet" href="../static/css/dnf-style.css" media="print" onload="this.media='all'">
    <!-- 对比页面样式（优先级最高） -->
    <link rel="stylesheet" href="../static/css/page/compare.css">
    <!-- 备用字体（防止微软雅黑缺失） -->
    <style>
        @font-face {
            font-family: 'Microsoft YaHei';
            src: local('Microsoft YaHei'), local('微软雅黑'), 
                 url('../static/fonts/msyh.ttf') format('truetype');
            font-display: swap;
        }
        /* 紧急样式兜底（防止CSS加载失败） */
        :root {
            --dnf-dark: #1a1a1a;
            --dnf-gold: #ffd700;
            --dnf-silver: #c0c0c0;
            --dnf-border: #8b7355;
            --dnf-bg-dark: #222;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        body {
            background: var(--dnf-dark);
            color: var(--dnf-silver);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .dnf-header { 
            background: var(--dnf-dark); 
            padding: 15px 0; 
            border-bottom: 2px solid var(--dnf-border); 
        }
        .header-content { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        .logo { 
            width: 50px; 
            height: 50px; 
            object-fit: contain;
        }
        .text-gold { color: var(--dnf-gold); }
        .text-silver { color: var(--dnf-silver); }
        .bg-dark { background: var(--dnf-bg-dark); }
        .rounded-md { border-radius: 8px; }
        .rounded-sm { border-radius: 4px; }
        .border-gold { border: 2px solid var(--dnf-border); }
        .border-base { border: 2px solid var(--dnf-border); }
        .p-1 { padding: 8px 12px; }
        .p-3 { padding: 15px; }
        .mb-3 { margin-bottom: 15px; }
        .mt-1 { margin-top: 8px; }
        .mt-2 { margin-top: 12px; }
        .text-center { text-align: center; }
        .breadcrumb { 
            background: #2a2a2a; 
            padding: 10px 0; 
            margin-bottom: 20px; 
        }
        .breadcrumb a { 
            color: var(--dnf-gold); 
            text-decoration: none;
        }
        .page-title { 
            color: var(--dnf-gold); 
            margin-bottom: 20px; 
            font-size: 24px; 
        }
        /* 选择区域样式 */
        .compare-selection {
            margin-bottom: 30px;
        }
        .selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .clear-btn {
            padding: 6px 12px;
            background: #ff4444;
            color: white;
            border: none;
            cursor: pointer;
        }
        .set-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .selection-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            background: var(--dnf-dark);
            color: var(--dnf-gold);
            outline: none;
        }
        .add-btn {
            padding: 8px 20px;
            background: var(--dnf-gold);
            color: var(--dnf-dark);
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        .add-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .selected-sets {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .selected-set-tag {
            background: var(--dnf-dark);
            border: 2px solid var(--dnf-border);
            border-radius: 4px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dnf-gold);
        }
        .remove-set {
            background: #ff4444;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        /* 空状态样式 */
        .empty-compare-state {
            text-align: center;
            padding: 80px 20px;
        }
        .empty-compare-state img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
        }
        /* 对比表格样式 */
        .compare-table {
            width: 100%;
            background: var(--dnf-bg-dark);
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        .table-header {
            display: flex;
            background: var(--dnf-dark);
            border-bottom: 2px solid var(--dnf-border);
        }
        .table-header > div {
            flex: 1;
            padding: 15px;
            text-align: center;
        }
        .header-cell h4 {
            color: var(--dnf-gold);
            margin: 0 0 5px 0;
        }
        .header-cell .alias {
            font-size: 12px;
            color: var(--dnf-silver);
        }
        .header-cell .difficulty {
            font-size: 12px;
            color: var(--dnf-border);
            margin-top: 5px;
        }
        .table-body .table-row {
            display: flex;
            border-bottom: 1px solid #333;
        }
        .table-row .row-label {
            flex: 1;
            padding: 12px;
            background: var(--dnf-dark);
            color: var(--dnf-gold);
            font-weight: bold;
        }
        .table-row .value-cell {
            flex: 1;
            padding: 12px;
            text-align: center;
        }
        .value-cell.highlight {
            color: #4CAF50;
            font-weight: bold;
        }
        /* 对比总结样式 */
        .compare-summary {
            background: var(--dnf-bg-dark);
            border: 2px solid var(--dnf-border);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .compare-summary h3 {
            color: var(--dnf-gold);
            margin-bottom: 15px;
        }
        .summary-point {
            margin: 10px 0;
            line-height: 1.6;
        }
        /* 弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal-content {
            background: var(--dnf-dark);
            border: 2px solid var(--dnf-border);
            border-radius: 8px;
            padding: 20px;
            min-width: 300px;
            max-width: 90%;
        }
        .modal-content h3 {
            color: var(--dnf-gold);
            margin-bottom: 15px;
        }
        .modal-close {
            padding: 8px 16px;
            background: var(--dnf-gold);
            color: var(--dnf-dark);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }
        /* 响应式适配 */
        @media (max-width: 768px) {
            .table-header, .table-row {
                flex-direction: column;
            }
            .header-cell, .row-label, .value-cell {
                border-bottom: 1px solid #333;
            }
            .set-selector {
                flex-direction: column;
            }
            .selection-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部导航 -->
    <header class="dnf-header">
        <div class="header-content container">
            <img src="../static/img/logo/dnf-logo.png" alt="DNF Logo" class="logo" onerror="this.src='../static/img/logo/default-logo.png'">
            <h1 class="text-gold">套装对比工具</h1>
        </div>
    </header>

    <!-- 返回导航 -->
    <nav class="breadcrumb">
        <div class="container">
            <a href="../index.html" class="text-gold">首页</a> > <span class="text-silver">套装对比</span>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="main-content compare-page">
        <div class="container">
            <h2 class="page-title text-center text-gold mb-3">套装对比工具</h2>
            
            <!-- 选择对比套装 -->
            <div class="compare-selection bg-dark rounded-md border-gold p-3">
                <div class="selection-header">
                    <h3 class="text-gold">选择要对比的套装 (最多4套)</h3>
                    <button onclick="clearSelection()" class="clear-btn rounded-sm">清空选择</button>
                </div>
                
                <div class="set-selector">
                    <select id="setSelector" class="selection-input rounded-md border-base" aria-label="选择要对比的套装">
                        <option value="">请选择套装</option>
                        <option value="gold">理想之黄金乡套装 (恍惚套)</option>
                        <option value="dragon">龙战八荒套装 (无色套)</option>
                        <option value="energy_3">究极能量套装（3觉） (三觉极限套)</option>
                        <option value="valkyrie">诸神黄昏之女武神 (持续输出套)</option>
                        <option value="energy_2">究极能量套装（2觉） (二觉续航套)</option>
                        <option value="nature">造化自然套装 (均衡发展套)</option>
                        <option value="spirit_orb">青丘灵珠套装（满珠） (灵珠buff套)</option>
                        <option value="chaos">混沌净化套装 (强力CD切换套)</option>
                        <option value="hunt">群猎美学套装 (高速回血减伤套)</option>
                        <option value="shadow">潜影暗袭套装 (影子机制手感套)</option>
                        <option value="mage_normal">冥思者的魔力领域 (魔力领域套)</option>
                        <option value="fate">天命者的气运 (技能重置套)</option>
                    </select>
                    <button onclick="addSetToCompare()" class="add-btn rounded-md" id="addCompareBtn">添加对比</button>
                </div>
                
                <!-- 已选择的套装 -->
                <div class="selected-sets" id="selectedSets">
                    <!-- 已选择的套装标签将在这里显示 -->
                </div>
                
                <!-- 提示信息 -->
                <div id="selectionTip" class="mt-1 text-silver" style="font-size: 14px;">
                    已选择 <span id="selectedCount">0</span>/4 套，至少选择2套可生成对比
                </div>
            </div>
            
            <!-- 对比结果 -->
            <div class="compare-result" id="compareResult">
                <div class="empty-compare-state">
                    <img src="../static/img/logo/dnf-logo.png" alt="Compare" onerror="this.src='../static/img/logo/default-logo.png'">
                    <h3 class="text-gold">开始您的第一次套装对比</h3>
                    <p class="text-silver">请从上方选择至少2套装进行对比分析</p>
                    <button onclick="document.getElementById('setSelector').focus()" class="mt-2 rounded-md bg-dark border-gold text-gold p-1" style="cursor: pointer;">
                        立即选择
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer style="background: var(--dnf-dark); padding: 20px 0; margin-top: 40px; border-top: 2px solid var(--dnf-border);">
        <div class="container text-center text-silver">
            <p>© 2025 DNF 115版本工具站 - 仅供参考，不代表官方</p>
            <p class="mt-1" style="font-size: 12px;">数据基于115版本最新更新，实际效果以游戏内为准</p>
        </div>
    </footer>

    <!-- 脚本加载 -->
    <script>
        // 全局套装数据（完整12套）
        const compareSetData = {
            "gold": {
                name: "理想之黄金乡套装",
                alias: "俗称\"恍惚套\"",
                difficulty: "极高",
                stats: {
                    "攻击速度": "20%~24%",
                    "移动速度": "20%~24%",
                    "释放速度": "20%~24%",
                    "伤害减免": "10%~12%",
                    "技能范围": "20%~24%",
                    "打造要求": "全身红12+",
                    "适用人群": "高端玩家",
                    "特色": "属性随增幅提升",
                    "伤害加成": "技攻+45%",
                    "冷却缩减": "5%",
                    "适用场景": "团本/高难度副本"
                }
            },
            "dragon": {
                name: "龙战八荒套装",
                alias: "俗称\"无色套\"",
                difficulty: "高",
                stats: {
                    "普通状态消耗减少": "无色消耗-5",
                    "普通状态速度": "三速+10%",
                    "激活状态速度": "三速+30%",
                    "激活状态伤害": "+3%",
                    "特殊效果": "无色技能特效伤害",
                    "打造要求": "太初品级",
                    "适用人群": "无色流玩家",
                    "特色": "双形态切换",
                    "伤害加成": "技攻+42%",
                    "冷却缩减": "10%",
                    "适用场景": "爆发输出/速刷"
                }
            },
            "energy_3": {
                name: "究极能量套装（3觉）",
                alias: "三觉极限套",
                difficulty: "极高",
                stats: {
                    "三觉伤害加成": "+60%",
                    "三觉冷却缩减": "-30%",
                    "技能攻击力": "+48%",
                    "攻击速度": "+15%",
                    "移动速度": "+15%",
                    "打造要求": "全身红11+",
                    "适用人群": "爆发型职业",
                    "特色": "极限三觉输出",
                    "冷却缩减": "8%",
                    "适用场景": "团本爆发阶段"
                }
            },
            "valkyrie": {
                name: "诸神黄昏之女武神",
                alias: "持续输出套",
                difficulty: "高",
                stats: {
                    "持续伤害加成": "+50%",
                    "技能循环效率": "提升25%",
                    "攻击速度": "+18%",
                    "移动速度": "+18%",
                    "伤害减免": "+15%",
                    "打造要求": "全身红10+",
                    "适用人群": "持续输出职业",
                    "特色": "无间隙输出",
                    "伤害加成": "技攻+40%",
                    "冷却缩减": "15%",
                    "适用场景": "长续航副本"
                }
            },
            "energy_2": {
                name: "究极能量套装（2觉）",
                alias: "二觉续航套",
                difficulty: "高",
                stats: {
                    "二觉伤害加成": "+45%",
                    "二觉冷却缩减": "-25%",
                    "技能攻击力": "+38%",
                    "攻击速度": "+12%",
                    "移动速度": "+12%",
                    "打造要求": "全身红10",
                    "适用人群": "二觉主力职业",
                    "特色": "二觉续航强化",
                    "冷却缩减": "12%",
                    "适用场景": "日常/周本"
                }
            },
            "nature": {
                name: "造化自然套装",
                alias: "均衡发展套",
                difficulty: "中",
                stats: {
                    "伤害加成": "技攻+35%",
                    "防御提升": "+20%",
                    "三速加成": "+10%",
                    "回血效果": "每秒2%",
                    "打造要求": "红7~红8",
                    "适用人群": "新手/过渡玩家",
                    "特色": "无明显短板",
                    "冷却缩减": "8%",
                    "适用场景": "全场景通用"
                }
            },
            "spirit_orb": {
                name: "青丘灵珠套装（满珠）",
                alias: "灵珠buff套",
                difficulty: "中",
                stats: {
                    "满层属性加成": "+30%全属性",
                    "三速加成": "+15%",
                    "技能伤害": "+32%",
                    "buff持续时间": "永久（满层）",
                    "打造要求": "红7",
                    "适用人群": "辅助/混团玩家",
                    "特色": "叠加型增益",
                    "冷却缩减": "5%",
                    "适用场景": "组队辅助"
                }
            },
            "chaos": {
                name: "混沌净化套装",
                alias: "强力CD切换套",
                difficulty: "高",
                stats: {
                    "净化模式技攻": "+10%",
                    "净化模式冷却": "-30%",
                    "净化模式护盾": "最大生命值10%",
                    "堕落模式冷却": "-55%",
                    "堕落模式霸体": "全程霸体",
                    "特殊能力": "二连跳",
                    "打造要求": "红10+",
                    "适用人群": "战术大师",
                    "特色": "双模式自由切换",
                    "伤害加成": "技攻+38%",
                    "适用场景": "高难度单刷"
                }
            },
            "hunt": {
                name: "群猎美学套装",
                alias: "高速回血减伤套",
                difficulty: "低",
                stats: {
                    "三速加成": "+30%",
                    "伤害减免": "+15%",
                    "单刷效果": "+24.1%技工",
                    "组队效果": "敌人受伤害+5%~8%",
                    "特殊能力": "易伤debuff",
                    "打造要求": "红0~红7",
                    "适用人群": "单刷爱好者",
                    "特色": "生存与输出并重",
                    "回血效果": "每秒5%",
                    "适用场景": "平民单刷"
                }
            },
            "shadow": {
                name: "潜影暗袭套装",
                alias: "影子机制手感套",
                difficulty: "中",
                stats: {
                    "核心机制": "影子层数系统",
                    "技能中断": "可中断当前技能",
                    "瞬移能力": "5层影子瞬移",
                    "速度提升": "三速最高+15%",
                    "手感优化": "全职业武神手感",
                    "打造要求": "红7~红8",
                    "适用人群": "操作追求者",
                    "特色": "革命性手感提升",
                    "伤害加成": "技攻+33%",
                    "冷却缩减": "10%",
                    "适用场景": "操作型玩家"
                }
            },
            "mage_normal": {
                name: "冥思者的魔力领域",
                alias: "魔力领域套（普通模式）",
                difficulty: "低",
                stats: {
                    "领域内伤害": "+35%技能伤害",
                    "自动回蓝": "每秒2%",
                    "三速加成": "+8%",
                    "魔法防御": "+25%",
                    "打造要求": "无需打造",
                    "适用人群": "法师新手",
                    "特色": "懒人专属",
                    "冷却缩减": "5%",
                    "适用场景": "新手过渡"
                }
            },
            "fate": {
                name: "天命者的气运",
                alias: "技能重置套",
                difficulty: "中",
                stats: {
                    "技能重置概率": "20%（非觉醒）",
                    "三速加成": "+10%",
                    "伤害加成": "技攻+30%",
                    "暴击率": "+8%",
                    "打造要求": "红7",
                    "适用人群": "技能型职业",
                    "特色": "无限技能循环",
                    "冷却缩减": "18%",
                    "适用场景": "技能爆发副本"
                }
            }
        };

        let selectedSets = [];
        const maxCompareSets = 4;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化按钮状态
            updateAddButtonState();
            // 监听选择框变化
            document.getElementById('setSelector').addEventListener('change', updateAddButtonState);
        });

        // 添加套装到对比
        function addSetToCompare() {
            const selector = document.getElementById('setSelector');
            const selectedValue = selector.value;
            
            if (!selectedValue) {
                showModal('提示', '<p>请先选择一个套装！</p>');
                return;
            }
            
            if (selectedSets.find(set => set.key === selectedValue)) {
                showModal('提示', '<p>该套装已在对比列表中！</p>');
                return;
            }
            
            if (selectedSets.length >= maxCompareSets) {
                showModal('提示', `<p>最多只能对比${maxCompareSets}套装！</p>`);
                return;
            }
            
            const setData = compareSetData[selectedValue];
            selectedSets.push({
                key: selectedValue,
                ...setData
            });
            
            selector.value = '';
            updateSelectedSetsDisplay();
            updateAddButtonState();
            
            if (selectedSets.length >= 2) {
                renderComparison();
            }
        }

        // 更新已选择套装显示
        function updateSelectedSetsDisplay() {
            const container = document.getElementById('selectedSets');
            
            container.innerHTML = selectedSets.map(set => `
                <div class="selected-set-tag">
                    <span>${set.name}</span>
                    <button class="remove-set" onclick="removeSetFromCompare('${set.key}')" title="移除">×</button>
                </div>
            `).join('');
            
            // 更新计数
            document.getElementById('selectedCount').textContent = selectedSets.length;
        }

        // 从对比中移除套装
        function removeSetFromCompare(setKey) {
            selectedSets = selectedSets.filter(set => set.key !== setKey);
            updateSelectedSetsDisplay();
            updateAddButtonState();
            
            if (selectedSets.length >= 2) {
                renderComparison();
            } else {
                showEmptyState();
            }
        }

        // 清空所有选择
        function clearSelection() {
            selectedSets = [];
            document.getElementById('setSelector').value = '';
            updateSelectedSetsDisplay();
            updateAddButtonState();
            showEmptyState();
        }

        // 更新添加按钮状态
        function updateAddButtonState() {
            const selector = document.getElementById('setSelector');
            const addBtn = document.getElementById('addCompareBtn');
            
            addBtn.disabled = !selector.value || selectedSets.length >= maxCompareSets;
            document.getElementById('selectedCount').textContent = selectedSets.length;
        }

        // 显示空状态
        function showEmptyState() {
            const resultDiv = document.getElementById('compareResult');
            resultDiv.innerHTML = `
                <div class="empty-compare-state">
                    <img src="../static/img/logo/dnf-logo.png" alt="Compare" onerror="this.src='../static/img/logo/default-logo.png'">
                    <h3 class="text-gold">开始您的第一次套装对比</h3>
                    <p class="text-silver">请从上方选择至少2套装进行对比分析</p>
                    <button onclick="document.getElementById('setSelector').focus()" class="mt-2 rounded-md bg-dark border-gold text-gold p-1" style="cursor: pointer;">
                        立即选择
                    </button>
                </div>
            `;
        }

        // 渲染对比结果
        function renderComparison() {
            if (selectedSets.length < 2) return;
            
            const resultDiv = document.getElementById('compareResult');
            
            // 生成对比表格
            const tableHtml = generateCompareTable();
            
            // 生成对比总结
            const summaryHtml = generateCompareSummary();
            
            resultDiv.innerHTML = `
                ${tableHtml}
                ${summaryHtml}
            `;
        }

        // 生成对比表格
        function generateCompareTable() {
            // 构建表头
            const headers = ['属性'].concat(selectedSets.map(set => `
                <div class="header-cell">
                    <h4>${set.name}</h4>
                    <div class="alias">${set.alias}</div>
                    <div class="difficulty">打造难度：${set.difficulty}</div>
                </div>
            `));
            
            // 获取所有属性键并排序
            const allStats = getAllStats().sort((a, b) => {
                const priority = {
                    '伤害加成': 1, '攻击速度': 2, '移动速度': 3, '冷却缩减': 4,
                    '打造要求': 5, '适用人群': 6, '特色': 7
                };
                return (priority[a] || 99) - (priority[b] || 99);
            });
            
            // 生成表格行
            const rows = allStats.map(stat => {
                const values = selectedSets.map(set => {
                    const value = set.stats[stat] || '-';
                    const highlightClass = getHighlightClass(stat, value, set);
                    return `<div class="value-cell ${highlightClass}">${value}</div>`;
                });
                
                return `
                    <div class="table-row">
                        <div class="row-label">${stat}</div>
                        ${values.join('')}
                    </div>
                `;
            }).join('');
            
            return `
                <div class="compare-table">
                    <div class="table-header">
                        ${headers.join('')}
                    </div>
                    <div class="table-body">
                        ${rows}
                    </div>
                </div>
            `;
        }

        // 获取所有属性键
        function getAllStats() {
            const allStats = new Set();
            selectedSets.forEach(set => {
                Object.keys(set.stats).forEach(stat => allStats.add(stat));
            });
            return Array.from(allStats);
        }

        // 获取高亮样式类
        function getHighlightClass(stat, value, currentSet) {
            if (value === '-') return '';
            
            // 数值型属性对比
            if (stat.match(/速度|加成|伤害|冷却|缩减|概率|提升/)) {
                const getNumericValue = (set) => {
                    const val = set.stats[stat] || '0';
                    const match = val.match(/(\d+(?:\.\d+)?)/);
                    return match ? parseFloat(match[1]) : 0;
                };
                
                const currentNum = getNumericValue(currentSet);
                const allNums = selectedSets.map(getNumericValue);
                const maxNum = Math.max(...allNums);
                
                // 冷却缩减特殊处理
                if (stat.includes('冷却') && stat.includes('缩减')) {
                    return currentNum === maxNum && currentNum > 0 ? 'highlight' : '';
                }
                
                // 伤害/速度加成
                if (stat.includes('伤害') || stat.includes('加成') || stat.includes('速度') || stat.includes('概率')) {
                    return currentNum === maxNum && currentNum > 0 ? 'highlight' : '';
                }
            }
            
            // 难度对比
            if (stat === '打造难度' || stat.includes('难度')) {
                const difficultyRank = { '低': 4, '中': 3, '高': 2, '极高': 1 };
                const currentRank = difficultyRank[currentSet.difficulty] || 0;
                const allRanks = selectedSets.map(set => difficultyRank[set.difficulty] || 0);
                const maxRank = Math.max(...allRanks);
                
                return currentRank === maxRank ? 'highlight' : '';
            }
            
            return '';
        }

        // 生成对比总结
        function generateCompareSummary() {
            const summary = analyzeSets();
            
            return `
                <div class="compare-summary">
                    <h3>对比分析总结</h3>
                    <div class="summary-content">
                        ${summary.map(point => `<div class="summary-point">${point}</div>`).join('')}
                    </div>
                </div>
            `;
        }

        // 分析套装特点
        function analyzeSets() {
            const points = [];
            const setNames = selectedSets.map(set => set.name);
            
            // 1. 难度分析
            const difficultyMap = { '低': '最低', '中': '中等', '高': '较高', '极高': '最高' };
            const easiestSet = selectedSets.reduce((prev, curr) => {
                const rank = { '低': 4, '中': 3, '高': 2, '极高': 1 };
                return rank[prev.difficulty] > rank[curr.difficulty] ? prev : curr;
            });
            
            const hardestSet = selectedSets.reduce((prev, curr) => {
                const rank = { '低': 4, '中': 3, '高': 2, '极高': 1 };
                return rank[prev.difficulty] < rank[curr.difficulty] ? prev : curr;
            });
            
            points.push(`打造难度：<strong>${easiestSet.name}</strong> 要求${difficultyMap[easiestSet.difficulty]}（适合新手），<strong>${hardestSet.name}</strong> 要求${difficultyMap[hardestSet.difficulty]}（适合高端玩家）`);
            
            // 2. 核心优势分析
            // 速度优势
            const speedSets = selectedSets.filter(set => {
                const speedVal = set.stats['三速加成'] || set.stats['攻击速度'] || '0';
                const num = parseFloat(speedVal.match(/\d+/)?.[0] || 0);
                return num >= 20;
            });
            if (speedSets.length > 0) {
                points.push(`速度优势：<strong>${speedSets.map(s => s.name).join('、')}</strong> 在三速加成上表现突出，手感最佳`);
            }
            
            // 伤害优势
            const damageSets = selectedSets.filter(set => {
                const dmgVal = set.stats['伤害加成'] || '0';
                const num = parseFloat(dmgVal.match(/\d+/)?.[0] || 0);
                return num >= 40;
            });
            if (damageSets.length > 0) {
                points.push(`伤害优势：<strong>${damageSets.map(s => s.name).join('、')}</strong> 伤害加成最高，输出能力最强`);
            }
            
            // 冷却优势
            const cdSets = selectedSets.filter(set => {
                const cdVal = set.stats['冷却缩减'] || '0';
                const num = parseFloat(cdVal.match(/\d+/)?.[0] || 0);
                return num >= 15;
            });
            if (cdSets.length > 0) {
                points.push(`冷却优势：<strong>${cdSets.map(s => s.name).join('、')}</strong> 冷却缩减最多，技能循环最快`);
            }
            
            // 3. 场景适配分析
            const soloSets = selectedSets.filter(set => set.name.includes('群猎美学') || set.stats['适用场景']?.includes('单刷'));
            if (soloSets.length > 0) {
                points.push(`单刷推荐：<strong>${soloSets.map(s => s.name).join('、')}</strong> 适合单人游玩，生存/输出兼顾`);
            }
            
            const teamSets = selectedSets.filter(set => set.name.includes('青丘灵珠') || set.stats['适用场景']?.includes('组队'));
            if (teamSets.length > 0) {
                points.push(`组队推荐：<strong>${teamSets.map(s => s.name).join('、')}</strong> 适合团队副本，辅助/爆发能力优秀`);
            }
            
            // 4. 综合建议
            const balancedSet = selectedSets.find(set => set.stats['特色']?.includes('均衡') || set.difficulty === '中');
            if (balancedSet) {
                points.push(`综合推荐：<strong>${balancedSet.name}</strong> 各项属性均衡，性价比最高，适合大多数玩家`);
            } else {
                const topSet = selectedSets[0];
                points.push(`综合推荐：<strong>${topSet.name}</strong> 在核心属性上表现最优，可作为优先选择`);
            }
            
            return points;
        }

        // 弹窗提示
        function showModal(title, content) {
            // 移除已存在的弹窗
            const oldModal = document.querySelector('.modal-overlay');
            if (oldModal) oldModal.remove();
            
            // 创建新弹窗
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>${title}</h3>
                    ${content}
                    <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">确定</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>